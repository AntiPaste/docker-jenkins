machine:
  services:
    - docker
  environment:
    PATH: $PATH:~/deps/bin

dependencies:
  cache_directories:
    - "~/docker"
    - "~/deps"
  pre:
    - if [[ ! -d ~/deps ]]; then mkdir -p ~/deps; fi
    - if [[ ! -d ~/docker ]]; then mkdir -p ~/docker; fi
    - git clone https://github.com/sstephenson/bats.git
    - cd bats && sudo ./install.sh ~/deps
  override:
    - docker info
    - if [ -e ~/docker/image.tar ]; then docker load --input ~/docker/image.tar; fi

test:
  override:
    - ./build.sh -nc ; ./test.sh

deployment:
  hub:
    branch: master
    commands:
      - $DEPLOY
