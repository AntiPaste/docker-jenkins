general:
  branches:
    only:
      - master
      - develop

machine:
  environment:
    DOCKER_IMAGE: jenkins
  services:
    - docker

dependencies:
  pre:
    - if [[ ! -e bats ]]; then git clone https://github.com/sstephenson/bats.git && cd bats && sudo ./install.sh /usr/local; fi
  cache_directories:
    - "~/docker"
  override:
    - docker info
    - ~/$CIRCLE_PROJECT_REPONAME/ci-test.sh

test:
  pre:
  override:
    - versions=( 1.* ) && versions=( "${versions[@]%/}" ) && versions=( $(printf '%s\n' "${versions[@]}"|sort -V) ) && for VERSION in "${versions[@]}"; do bats tests ; done

#deployment:
#  hub:
#    branch: master
#    commands:
#      - docker login -e $DOCKER_EMAIL -u $DOCKER_USER -p $DOCKER_PWD
#      - docker push $CIRCLE_PROJECT_USERNAME/$DOCKER_IMAGE:$VERSION
