machine:
  services:
    - docker

dependencies:
  cache_directories:
    - "~/docker"
    - "~/deps"
  pre:
    - [[ ! -d ~/deps ]] && mkdir -p ~/deps
    - [[ ! -d ~/docker ]] && mkdir -p ~/docker
    - git clone https://github.com/sstephenson/bats.git
    - cd bats && sudo ./install.sh ~/deps
  override:
    - docker info
    - if [ -e ~/docker/image.tar ]; then docker load --input ~/docker/image.tar; fi

test:
  override:
    - ./build.sh -nc
    - ./test.sh

deployment:
  hub:
    branch: master
    commands:
      - $DEPLOY
